<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="../_shared/shared.css">
		<script src="../../src/sage.math.js"></script>

		<script src="../../src/sage.webgl/sage.webgl.js"></script>
		<script src="../../src/sage.webgl/sage.webgl.CanvasGL.js"></script>
		<script src="../../src/sage.webgl/sage.webgl.Shader.js"></script>
		<script src="../../src/sage.webgl/sage.webgl.CubeMesh.js"></script>
		<script>
  			var cgl,shader;
  			var vertices = [
  				-0.9, -0.9, 0.0,
  				 0.9, -0.9, 0.0,
  				 0.0,  0.9, 0.0
  			];

  			var angle = 0;

			window.addEventListener("load",function(){
				//Prepare WebGL and Camera
				cgl = new sage.webgl.CanvasGL("canvas01")
					.setSize(500,500)
					.setBackgroundColor(0,0,0,0);

				var vertBuf = cgl.createBuffer(vertices);

				shader = new sage.webgl.Shader(cgl);
				shader.createProgram("vertShader","fragShader",false);
				//shader.addAttribFloat("coords",0,0,0);
				shader.addAttribAryBuffer("coords",3,vertBuf);
				shader.addAttribFloat("psize",10);
				shader.addUniformFloat("color",0,1,0,1);
				shader.addUniformMatrix4fv("transMat",rotateZ(angle));

				drawFunc();
			});

			function draw(){
				//delta *= 0.4; //Slow down the rotation speed
				cgl.clear(); //clear the scene
				//cgl.mGL.drawArrays(cgl.mGL.POINTS,0,1);		//Draw single point when passing with addAttribFloat 3 floats
				//cgl.mGL.drawArrays(cgl.mGL.POINTS,0,3);		//Draw 3 points when passing an array of 9 floats (3 sets of points)
				//cgl.mGL.drawArrays(cgl.mGL.LINES,0,3);		//draws a line by 2 set of points at a time, 0-1,2-3,4-5
				//cgl.mGL.drawArrays(cgl.mGL.LINE_STRIP,0,3);	//draws a line to each point but does not close to first point
				//cgl.mGL.drawArrays(cgl.mGL.LINE_LOOP,0,3);		//draws a line to each point then connects last and first point
				cgl.mGL.drawArrays(cgl.mGL.TRIANGLES,0,3);		//draws a line to each point then connects last and first point
			}


			function rotateZ(angle) {
			  var cos = Math.cos(angle),
			      sin = Math.sin(angle),
			      mat =  new Float32Array(
			                [cos, sin, 0, 0,
			               -sin, cos, 0, 0,
			                  0,   0, 1, 0,
			                  0,   0, 0, 1]);
			  return mat;
			}

			function degRad(v){ return v * (Math.PI/180); }

			
			function drawPoints(){ cgl.clear(); cgl.mGL.drawArrays(cgl.mGL.POINTS,0,3); drawFunc = drawPoints; }
			function drawLines(){ cgl.clear(); cgl.mGL.drawArrays(cgl.mGL.LINE_LOOP,0,3); drawFunc = drawLines;}
			function drawFill(){ cgl.clear(); cgl.mGL.drawArrays(cgl.mGL.TRIANGLES,0,3);  drawFunc = drawFill; }

			function updatePoint(v){
				shader.updateAttribFloat("psize",v);
				drawFunc();
			}

			function updateAngle(v){
				shader.updateUniformMatrix4fv("transMat",rotateZ(degRad(v)));
				drawFunc();
			}

			var drawFunc = drawPoints;

			//UI control stuff
			function preview(o){ o.previousSibling.innerHTML = o.value; }
		</script>
	</head>
<body>

<script id="vertShader" type="x-shader/x-vertex">
	attribute vec4 coords;
	attribute float psize;

	uniform mat4 transMat;

	void main(void) {
		gl_Position = transMat * coords;
		gl_PointSize = psize;
	}
</script>

<script id="fragShader" type="x-shader/x-fragment">
	precision mediump float;
	uniform vec4 color;
	void main(void) {
		gl_FragColor = color; //vec4(0.0, 1.0, 0.0, 1.0);
	}
</script>


<div class="rowFlex" style="width:800px; margin:0px auto;">
	<section style="width:500px;">
		<div class="NodeContainer" style="display:inline-block;">
			<header>WebGL Enabled Canvas</header>
			<canvas id="canvas01"></canvas>
		</div>
	</section>

	<section>
		<div class="NodeContainer">
			<header style="margin-bottom:20px;">Shader Control</header>
			<div class="ctrRow">
				<span>Point Size: </span><label>10</label><input id="yrot" class="slider" type="range" min="2" max="100" value="10" onInput="preview(this);" onChange="updatePoint(this.value);"/>
			</div>

			<div class="ctrRow">
				<span>Rotation Z: </span><label>0</label><input id="yrot" class="slider" type="range" min="0" max="360" value="0" onInput="preview(this);" onChange="updateAngle(this.value);"/>
			</div>

			<div class="ctrRow full">
				<input type="button" id="btn1" onClick="drawPoints(); this.blur();" value="Draw Points" style="display:block;">
			</div>

			<div class="ctrRow full">
				<input type="button" id="btn1" onClick="drawLines(); this.blur();" value="Draw Lines" style="display:block;">
			</div>

			<div class="ctrRow full">
				<input type="button" id="btn1" onClick="drawFill(); this.blur();" value="Draw Fill" style="display:block;">
			</div>
		</div>
	<section>
</div>

<div class="rowFlex">
	<section>
		<p style="color:#a0a0a0; bottom:1px;">
			<i style="color:lime;">WebGL Experiments : Basics with Shaders and Points</i><br>
		

			- <a href="https://github.com/sketchpunk/SageJS" style="color:orange;text-decoration:none;">Source on Github</a><br><br>

			<br><br>&copy; 2016 Sketchpunk Labs;
		</p>
	</section>
</div>

</body>
</html>